<mah:MetroWindow x:Class="SCRMTracker.MainWindow"
                 xmlns:local="clr-namespace:SCRMTracker"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
                 xmlns:Controls="http://metro.mahapps.com/winfx/xaml/controls"
                 xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 Title="SC:RM User Tracker"
                 Width="1015"
                 Height="770"
                 MinWidth="1015"
                 MinHeight="770"
                 IsMaxRestoreButtonEnabled="False"
                 ShowMaxRestoreButton="False" 
                 WindowStartupLocation="CenterScreen"
                 PreviewKeyDown="MetroWindow_PreviewKeyDown"
                 mc:Ignorable="d" Loaded="MetroWindow_Loaded">

    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl x:Name="flyoutsControl"/>
    </Controls:MetroWindow.Flyouts>

    <mah:MetroWindow.RightWindowCommands>
        <mah:WindowCommands>
            <Button Click="settingsButton_Click" Content="환경설정">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconFeatherIcons Width="22" Height="22" VerticalAlignment="Center" Kind="Settings" />
                            <TextBlock Margin="4 0 0 0" VerticalAlignment="Center" Text="{Binding}"/>
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
            <Button Click="aboutButton_Click" Content="프로그램 정보">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconFontAwesome Width="22" Height="22" VerticalAlignment="Center" Kind="CircleQuestionRegular" />
                            <TextBlock Margin="4 0 0 0" VerticalAlignment="Center" Text="{Binding}"/>
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
        </mah:WindowCommands>
    </mah:MetroWindow.RightWindowCommands>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 상단 네트워크 어댑터 영역 -->
            <RowDefinition Height="*"/>
            <!-- 상단 컨텐츠 영역 (현재 방 + 로그) -->
            <RowDefinition Height="*"/>
            <!-- 하단 컨텐츠 영역 (플레이어 DB) -->
        </Grid.RowDefinitions>

        <!-- 상단: 네트워크 어댑터 선택 및 캡처 버튼 -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <!-- 레이블 -->
                <ColumnDefinition Width="*"/>
                <!-- 콤보박스 -->
                <ColumnDefinition Width="Auto"/>
                <!-- 캡처 시작 -->
                <ColumnDefinition Width="Auto"/>
                <!-- 캡처 중지 -->
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0" 
                   Content="네트워크 어댑터:" 
                   VerticalAlignment="Center"
                   Margin="0,0,10,0"/>

            <ComboBox x:Name="adapterComboBox" Grid.Column="1" 
                      Height="31" 
                      VerticalAlignment="Center"
                      Margin="0,0,10,0"/>

            <Button x:Name="startCaptureButton" Grid.Column="2" 
                    Content="캡처 시작" 
                    Height="31" 
                    Width="94"
                    Style="{StaticResource MahApps.Styles.Button.Flat}"
                    Margin="0,0,5,0" Click="startCaptureButton_Click"/>

            <Button x:Name="stopCaptureButton" Grid.Column="3" 
                    Content="캡처 중지" 
                    Height="31" 
                    Width="87"
                    IsEnabled="False"
                    Style="{StaticResource MahApps.Styles.Button.Flat}" Click="stopCaptureButton_Click"/>
        </Grid>

        <!-- 상단 패널: 현재 방 + 로그 (가로 배치) -->
        <Grid Grid.Row="1" Margin="0,0,0,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="7*"/>
                <!-- 현재 방 (70%) -->
                <ColumnDefinition Width="3*"/>
                <!-- 로그 (30%) -->
            </Grid.ColumnDefinitions>

            <GroupBox Grid.Column="0" 
          Header="입장한 플레이어 목록 (더블 클릭으로 복사)" 
          Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <!-- DataGrid -->
                        <RowDefinition Height="Auto"/>
                        <!-- 버튼 영역 -->
                    </Grid.RowDefinitions>

                    <DataGrid Grid.Row="0"
          x:Name="currentRoomDataGrid" 
          IsReadOnly="True" 
          AutoGenerateColumns="False"
          VirtualizingPanel.VirtualizationMode="Recycling"
          VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.IsVirtualizingWhenGrouping="True" 
          GridLinesVisibility="All" 
          Margin="0,0,0,5" 
          ScrollViewer.HorizontalScrollBarVisibility="Visible" 
          ScrollViewer.VerticalScrollBarVisibility="Visible" 
          ScrollViewer.CanContentScroll="True" PreviewMouseDoubleClick="CopyCellContentByDoubleClick">

                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource MahApps.Styles.DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsBlackList}" Value="True">
                                        <Setter Property="Foreground" Value="Red"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding JoinTime}" CanUserReorder="True" Header="입장 시각" Width="Auto"/>
                            <DataGridTextColumn Binding="{Binding PID}" CanUserReorder="True" Header="PID" Width="Auto"/>
                            <DataGridTextColumn Binding="{Binding Username}" CanUserReorder="True" Header="ID" Width="Auto"/>
                            <DataGridTextColumn Binding="{Binding BattleTag}" CanUserReorder="True" Header="배틀태그" Width="Auto"/>
                            <DataGridTextColumn Binding="{Binding IPAddress}" CanUserReorder="True" Header="IP 주소" Width="Auto"/>
                            <DataGridTextColumn Binding="{Binding Comment}" CanUserReorder="True" Header="메모" Width="Auto"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="1" 
                    Orientation="Horizontal"
                    HorizontalAlignment="Left"
                    Margin="0,5,0,0">
                        <Button x:Name="clearRoomListButton" 
                    Content="목록 초기화" 
                    Height="31" 
                    Width="100"
                    Style="{StaticResource MahApps.Styles.Button.Flat}"
                    Margin="0,0,10,0" Click="clearRoomListButton_Click"/>

                      <CheckBox x:Name="autoScrollCheckBox" 
                      Content="아래로 자동 스크롤" 
                      Height="31"
                      FontSize="14"
                      VerticalAlignment="Center"
                      IsChecked="True"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 로그 GroupBox -->
            <GroupBox Grid.Column="1" 
                      Header="로그" 
                      Margin="5,0,0,0">
                <TextBox x:Name="logTextBox" TextWrapping="Wrap" 
                         Text="" 
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"
                         IsReadOnly="True" FontSize="10"/>
            </GroupBox>
        </Grid>

        <GroupBox x:Name="databaseGroupBox" Grid.Row="2" 
          Header="플레이어 데이터베이스 관리"
          Margin="0,5,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <!-- DataGrid -->
                    <RowDefinition Height="Auto"/>
                    <!-- 하단 컨트롤 영역 -->
                </Grid.RowDefinitions>

                <!-- 플레이어 DataGrid -->
                <DataGrid Grid.Row="0"
                  x:Name="playerDbDataGrid" 
                  Margin="0,0,0,10"
                  IsReadOnly="True" 
                  AutoGenerateColumns="False"
                  VirtualizingPanel.VirtualizationMode="Recycling"
                  VirtualizingPanel.IsVirtualizing="True"
                  VirtualizingPanel.IsVirtualizingWhenGrouping="True" 
                  GridLinesVisibility="All" 
                  HorizontalScrollBarVisibility="Visible" 
                  VerticalScrollBarVisibility="Visible" PreviewMouseDoubleClick="CopyCellContentByDoubleClick">

                    <DataGrid.Columns>
                        <DataGridTextColumn Binding="{Binding BattleTag}" CanUserReorder="True" Header="배틀태그" Width="180"/>
                        <DataGridTextColumn Binding="{Binding IsBlackList}" CanUserReorder="True" Header="블랙리스트" Width="85"/>
                        <DataGridTextColumn Binding="{Binding MeetDate}" CanUserReorder="True" Header="등록일" Width="100"/>
                        <DataGridTextColumn Binding="{Binding UsernameListStr}" CanUserReorder="True" Header="사용한 ID 목록" Width="140"/>
                        <DataGridTextColumn Binding="{Binding Comment}" CanUserReorder="True" Header="메모" Width="Auto"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- 하단: 검색/필터 및 버튼 영역 -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <!-- 필터 타입 콤보박스 -->
                        <ColumnDefinition Width="*"/>
                        <!-- 검색 텍스트박스 -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- 블랙리스트 체크박스 -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- 버튼 영역 -->
                    </Grid.ColumnDefinitions>

                    <!-- 필터 타입 콤보박스 -->
                    <ComboBox x:Name="searchOptionComboBox" Grid.Column="0" 
                      Height="31" 
                      Width="106"
                      SelectedIndex="0" 
                      FontSize="12"
                      Margin="0,0,5,0" SelectionChanged="searchOptionComboBox_SelectionChanged">
                        <ComboBoxItem Content="배틀태그"/>
                        <ComboBoxItem Content="ID"/>
                        <ComboBoxItem Content="메모"/>
                    </ComboBox>

                    <!-- 검색 텍스트박스 -->
                    <TextBox x:Name="searchTextBox" Grid.Column="1" 
                     Height="31"
                     TextWrapping="Wrap" 
                     Text="" 
                     FontSize="12"
                     Margin="0,0,5,0" TextChanged="searchTextBox_TextChanged">
                        <TextBox.Style>
                            <Style BasedOn="{StaticResource MahApps.Styles.TextBox}" TargetType="{x:Type TextBox}">
                                <Setter Property="Controls:TextBoxHelper.ClearTextButton" Value="True" />
                                <Style.Triggers>
                                    <Trigger Property="Controls:TextBoxHelper.HasText" Value="False">
                                        <Setter Property="Controls:TextBoxHelper.ClearTextButton" Value="False" />
                                        <Setter Property="Controls:TextBoxHelper.Watermark" Value="필터링 할 내용을 입력하세요 (Ctrl+F)" />
                                    </Trigger>
                                    <Trigger Property="Controls:TextBoxHelper.HasText" Value="True">
                                        <Setter Property="Controls:TextBoxHelper.ClearTextButton" Value="True" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- 블랙리스트만 표시 체크박스 -->
                    <CheckBox x:Name="showBlacklistCheckBox" Grid.Column="2" 
                      Content="블랙리스트만 표시" 
                      Height="31"
                      FontSize="12"
                      VerticalAlignment="Center"
                      Margin="0,0,5,0" Unchecked="showBlacklistCheckBox_CheckedChanged" Checked="showBlacklistCheckBox_CheckedChanged"/>

                    <!-- 버튼 영역 -->
                    <StackPanel Grid.Column="3" 
                        Orientation="Horizontal"
                        Margin="5,0,0,0">
                        <Button x:Name="modifyPlayerButton" 
                        Content="선택한 플레이어 수정" 
                        Height="31" 
                        Width="156"
                        Style="{StaticResource MahApps.Styles.Button.Flat}"
                        Margin="0,0,5,0" Click="modifyPlayerButton_Click"/>

                        <Button x:Name="removePlayerButton" 
                        Content="선택한 플레이어 삭제" 
                        Height="31" 
                        Width="156"
                        Style="{StaticResource MahApps.Styles.Button.Flat}"
                        Margin="5,0,0,0" Click="removePlayerButton_Click"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </GroupBox>
    </Grid>
</mah:MetroWindow>